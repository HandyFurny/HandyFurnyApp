<!--Vine del item que he seleccionado del catalog-list y renderiza la info del item 
y la informaciÃ³n del seller y el chat y la lista de los otros items que quiero  -->
<nav>
  <div>
      <h3>Handy Furny</h3>
  </div>
  <div>
      <ul>
          <li><a href="#">Home</a></li>
          <li><a href="/logout">Log Out</a></li>
          <li><a href="/catalog/new">New Product</a></li>
          <li><a href="/catalog/list">All Products</a> </li>

      </ul>
  </div>
</nav>
<h2>CHAT</h2>

<style>
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font: 13px Helvetica, Arial; }
    form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 70%; }
    form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
    form button { width: 9%; background: rgb(36, 206, 169); border: none; padding: 10px; }
    #messages { list-style-type: none; margin: 0; padding: 0; }
    #messages li { padding: 5px 10px; }
    #messages li:nth-child(odd) { background: #eee; }
  </style>
<section class="chat">

    <div class="item-chat-container">
        
          <div>
            <img class="item-img-chat" src="<%= item.itemPic %>">
          </div>
          <div>
            <h2> <%=item.title%> $<%=item.price %></h2>
            <span class="item-category"><%= item.category %></span>
            <p> Description: <br> <%= item.description%></p>
          </div>
      
    </div>
    <div class="chat-form">
    
      <ul id="messages">
        <% if (doc!=undefined){%>
          <% doc.messages.forEach(m=>{%>
            <li><%=m%></li>
          <%})%>
       
       <%}else {%>
         <li></li>
         <%}%>
      </ul>
      <form action="">
        <input id="m" autocomplete="off" /><button>Send</button>
      </form>
    
    
    </div>




</section>


  

   <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
   <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
   <script type="text/javascript" src="javascripts/chat/firstchat.js"></script>
   <script>
     $(function () {
       var socket = io().connect('http://localhost:3000');
       $('form').submit(function(){
      
          var msgtoSocketIO={
           text:$('#m').val(),
           itemID:"<%=item._id%>",
           username1:"<%=user.username%>",
           user1_id:"<%=user._id%>",
           user2_id:"<%=item._creator._id%>"
         };

         console.log("entro a mandar la informacion")

    
 // enviando el mensaje
 //socket.emit("private", { msg:msgtoSocketIO, to: selected.text() });
        socket.emit('chat message',msgtoSocketIO);
         $('#m').val('');
         return false;
       });

//recibiendo el mensaje
        //socket.on("private", function(msg) {    
 //  $('#messages').append('<li class="private"><em><strong>'+ msg.from +' -> '+ msg.to +'</strong>: '+ msg.msg +'</em></li>');
       
       socket.on('chat message', function(msg){
      $('#messages').append($('<li>').text(msg));
        window.scrollTo(0, document.body.scrollHeight);
      });

        /*
    Message listener
  */
  $("#msg").keypress((e) => {
    if (e.which !== 13) {
      if (_typing === false && $('#msg').is(':focus')) {
        _typing = true;
        socket.emit('user typing', true);
        _timeout = setTimeout(resetTyping, 3000);
      } else {
        clearTimeout(_timeout);
        _timeout = setTimeout(resetTyping, 3000);
      }
    }
  });
  
 });
   </script>



